#!/usr/bin/env bash

# Show a pretty `git log` with a graph.
#
# Usage:
#
# $ git graph [-a|-ac] [-d] [-l] ...
#
# -a: print "author" datetimes (default: "committer")
# -ac: print "author" and "committer" datetimes
# -d: render ISO datetimes (default: "relative")
# -l: render local datetimes (default: "relative")
#
# Other args are passed through to `git log`

set -e

args=()
date_type='%cd'
date_fmt="relative"
include_upstream=
while [ $# -gt 0 ]; do
    arg="$1"; shift
    case "$arg" in
    -a) date_type="%ad" ;;
    -ac) date_type="%ad %C(green)%cd" ;;
    -d) date_fmt="iso" ;;
    -l) date_fmt="local" ;;
    -u) include_upstream=1 ;;
    *) args+=("$arg") ;;
    esac
done

if [ -n "$include_upstream" ]; then
    args+=("$(git tracked-branch)")
fi

set -- "${args[@]}"

git log \
  --graph \
  "--format=%C(auto)%h %C(blue)${date_type} %C(red)%an%C(reset)%C(reset)%C(auto)%d %s" \
  "--date=$date_fmt" \
  --date-order \
  "$@"
