#!/usr/bin/env bash

# Pretty-print remote branch info.

# If arg is a remote name, expand to remote/*
args=()
for arg in "$@"; do
    if git remote | grep -qxF "$arg"; then
        args+=("$arg/*")
    else
        args+=("$arg")
    fi
done

# Get matching branches
branches=$(git branch -rvv --list "${args[@]}" | awk -F' ' '{print $1}')

# Fall back to all if no matches
if [ -z "$branches" ] && [ ${#args[@]} -gt 0 ]; then
    echo "No branches matching: ${args[*]}" >&2
    branches=$(git branch -rvv | awk -F' ' '{print $1}')
fi

echo "$branches" | \
xargs git --no-pager show -s --format="%d %h %ci (%cr) %s" | \
sed -n "s/\(.\)/\1/p" | \
python "$(dirname "${BASH_SOURCE[0]}")"/../git_helpers/util/remote_branch_infos.py

